<story-context id="story-context-1.8" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>8</storyId>
    <title>Document Developer Onboarding &amp; Runbooks</title>
    <status>Draft</status>
    <generatedAt>2025-10-20T15:31:11Z</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/story-1.8.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>an engineering lead</asA>
    <iWant>developer onboarding guides and runbooks documented</iWant>
    <soThat>new contributors can spin up environments and troubleshoot quickly</soThat>
    <tasks><![CDATA[
- Task 1 (AC: 1) – Audit and refresh `docs/onboarding.md` with setup prerequisites, environment bootstrap, and CI usage guidance.
- Task 2 (AC: 2) – Expand the deployment runbook to cover release flows, rollback execution, and contact chain for Vercel and Railway operations.
- Task 3 (AC: 3) – Ensure README and supporting documentation link directly to the onboarding guide and runbooks for quick discovery.
    ]]></tasks>
  </story>

  <acceptanceCriteria><![CDATA[
1. `docs/onboarding.md` documents prerequisites, environment bootstrap, and CI/testing expectations end-to-end so new contributors can self-serve setup.
2. Deployment operations runbook details standard releases, rollback execution, and escalation contacts for staging and production environments.
3. Onboarding and runbook documentation live under `docs/` and are linked from the repository README for discoverability.
  ]]></acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>cs - Epic Breakdown</title>
        <section>Story 1.9: Document Developer Onboarding &amp; Runbooks</section>
        <snippet>Epic 1 lists Story 1.9 “Document Developer Onboarding &amp; Runbooks,” describing the engineering lead goal to deliver onboarding guides and deployment runbooks. The acceptance criteria demand coverage of local setup, environment management, CI expectations, and README references.</snippet>
      </doc>
      <doc>
        <path>docs/bmm-workflow-status.md</path>
        <title>Project Workflow Status</title>
        <section>TODO (Needs Drafting)</section>
        <snippet>The workflow status tracker flags Story ID 1.8 “Document Developer Onboarding &amp; Runbooks” as the next drafting task. It instructs the Scrum Master to run create-story, confirming this story’s priority in the queue.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Technical Specification: Platform Foundation &amp; Deployment Pipeline</title>
        <section>Onboarding Documentation &amp; Non-Functional Requirements</section>
        <snippet>The Epic 1 technical specification mandates maintaining docs/onboarding.md and docs/runbooks/deployments.md as canonical references. It enumerates tooling, CI expectations, and documentation QA criteria that inform story acceptance.</snippet>
      </doc>
      <doc>
        <path>docs/onboarding.md</path>
        <title>Developer Onboarding Guide</title>
        <section>Prerequisites &amp; Getting Started</section>
        <snippet>The onboarding guide walks contributors through prerequisites, cloning the repository, installing dependencies, and running scripts/bootstrap.ts for each environment. It also maps the workspace layout across apps, packages, docs, scripts, and tests.</snippet>
      </doc>
      <doc>
        <path>docs/runbooks/deployments.md</path>
        <title>Deployment Runbook</title>
        <section>Deployment Procedures</section>
        <snippet>The deployment runbook details Vercel staging and production flows, branch triggers, and the manual CLI commands for promoting builds. Monitoring links, troubleshooting steps, and rollback procedures give operators actionable guidance.</snippet>
      </doc>
      <doc>
        <path>docs/runbooks/environment-config.md</path>
        <title>Environment Configuration Runbook</title>
        <section>Architecture &amp; Variable Matrix</section>
        <snippet>This runbook catalogs environment files for storefront, Medusa, and Strapi and lists critical secrets with rotation cadence. It documents bootstrap commands, generated file matrices, and security practices governing configuration updates.</snippet>
      </doc>
      <doc>
        <path>docs/runbooks/ci-pipeline.md</path>
        <title>CI Pipeline Runbook</title>
        <section>Pipeline Architecture &amp; Troubleshooting</section>
        <snippet>The CI pipeline runbook covers workflow triggers, matrix jobs, and cache troubleshooting for GitHub Actions. It prescribes local commands and remediation steps for dependency or test failures before rerunning pipelines.</snippet>
      </doc>
      <doc>
        <path>docs/solution-architecture.md</path>
        <title>Solution Architecture Document</title>
        <section>Proposed Source Tree</section>
        <snippet>The solution architecture enumerates apps, packages, infra, scripts, and tests directories that documentation should reference. Critical folder notes highlight routes, shared packages, and subscriber locations to keep onboarding material aligned.</snippet>
      </doc>
      <doc>
        <path>README.md</path>
        <title>cs Monorepo README</title>
        <section>Workspace Layout &amp; Environment Setup</section>
        <snippet>The README summarizes workspace layout, environment setup commands, and core pnpm scripts. Cross-linking this file to onboarding and runbooks helps contributors find deeper documentation quickly.</snippet>
      </doc>
      <doc>
        <path>docs/stories/story-1.5.md</path>
        <title>Story 1.5: Implement Preview Deployments Per Pull Request</title>
        <section>Implementation Summary &amp; Security Notes</section>
        <snippet>Story 1.5 completion notes capture the preview deployment pipeline, bootstrap enhancements, and validation scripts introduced for security. Documentation updates should reference these decisions to stay consistent with CI automation.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>scripts/bootstrap.ts</path>
        <kind>script</kind>
        <symbol>environments</symbol>
        <lines>1-160</lines>
        <reason>Generates environment-specific configuration files consumed by onboarding steps and the environment runbook.</reason>
      </artifact>
      <artifact>
        <path>scripts/deploy.ts</path>
        <kind>script</kind>
        <symbol>main</symbol>
        <lines>1-160</lines>
        <reason>Implements the CLI flow for staging and production deployments described in the deployment runbook.</reason>
      </artifact>
      <artifact>
        <path>scripts/validate-preview-config.ts</path>
        <kind>script</kind>
        <symbol>validateEnvironmentFile</symbol>
        <lines>1-160</lines>
        <reason>Validates preview environment variables to prevent production secrets leakage, mirroring Story 1.5 security guardrails.</reason>
      </artifact>
      <artifact>
        <path>scripts/deployment-status.ts</path>
        <kind>script</kind>
        <symbol>DeploymentStatusReporter</symbol>
        <lines>1-200</lines>
        <reason>Generates deployment summaries, GitHub outputs, and Slack notifications that documentation should reference for status reporting.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="workspace">
        <package name="turbo" version="^2.1.1"/>
        <package name="tsx" version="^4.7.0"/>
      </ecosystem>
      <ecosystem name="storefront">
        <package name="next" version="15.5.6"/>
        <package name="@tanstack/react-query" version="^5.90.5"/>
        <package name="zustand" version="^5.0.8"/>
      </ecosystem>
      <ecosystem name="medusa">
        <package name="@medusajs/framework" version="2.10.3"/>
        <package name="@medusajs/medusa" version="2.10.3"/>
        <package name="pg" version="^8.13.0"/>
      </ecosystem>
      <ecosystem name="strapi">
        <package name="@strapi/strapi" version="5.28.0"/>
        <package name="styled-components" version="^6.0.0"/>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Documentation updates must align with environment secret rotation, bootstrap procedures, and tooling requirements defined in docs/runbooks/environment-config.md and docs/tech-spec-epic-1.md.</constraint>
    <constraint>Deployment guidance needs to reflect preview cleanup, CLI automation, and monitoring processes captured in docs/runbooks/deployments.md and docs/stories/story-1.5.md.</constraint>
    <constraint>Onboarding references should reinforce workspace layout and CI/test expectations from docs/solution-architecture.md, README.md, and docs/runbooks/ci-pipeline.md.</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Bootstrap CLI</name>
      <kind>command</kind>
      <signature>tsx scripts/bootstrap.ts --env &lt;local|preview|staging|production&gt;</signature>
      <path>scripts/bootstrap.ts</path>
    </interface>
    <interface>
      <name>Deploy CLI</name>
      <kind>command</kind>
      <signature>tsx scripts/deploy.ts &lt;staging|production&gt; &lt;branch&gt;</signature>
      <path>scripts/deploy.ts</path>
    </interface>
    <interface>
      <name>Validate Preview CLI</name>
      <kind>command</kind>
      <signature>tsx scripts/validate-preview-config.ts</signature>
      <path>scripts/validate-preview-config.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Follow the CI pipeline runbook to run pnpm lint, pnpm test:unit, and deployment smoke checks, and reference the tech spec’s requirement for Playwright preview validation when updating documentation.</standards>
    <locations><![CDATA[
- tests/e2e
- apps/storefront
- apps/medusa
- apps/strapi
- scripts/
    ]]></locations>
    <ideas><![CDATA[
- AC1: Dry-run onboarding commands (pnpm install, scripts/bootstrap.ts --env local) to confirm the documented setup remains accurate.
- AC2: Execute the staged deployment script (`pnpm deploy:staging staging`) or simulate via deployment-status reporter to validate runbook steps and rollback guidance.
- AC3: Run a markdown link check to ensure README references point to docs/onboarding.md and docs/runbooks/ assets after updates.
    ]]></ideas>
  </tests>
</story-context>
