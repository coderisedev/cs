# Medusa 管理面板运营操作指南

本文档面向运营人员，介绍如何使用 Medusa 管理面板完成日常商城运营工作。

## 目录

- [登录管理面板](#登录管理面板)
- [面板总览](#面板总览)
- [商品管理](#商品管理)
  - [查看商品列表](#查看商品列表)
  - [创建新商品](#创建新商品)
  - [编辑商品信息](#编辑商品信息)
  - [管理商品变体与定价](#管理商品变体与定价)
  - [上传商品图片](#上传商品图片)
  - [管理库存](#管理库存)
- [商品合集管理](#商品合集管理)
  - [创建合集](#创建合集)
  - [合集排序](#合集排序)
  - [将商品添加到合集](#将商品添加到合集)
- [商品分类管理](#商品分类管理)
- [订单管理](#订单管理)
  - [查看订单列表](#查看订单列表)
  - [查看订单详情](#查看订单详情)
  - [处理发货](#处理发货)
  - [处理退款](#处理退款)
- [客户管理](#客户管理)
  - [查看客户列表](#查看客户列表)
  - [查看客户详情](#查看客户详情)
  - [客户分组](#客户分组)
- [区域与货币](#区域与货币)
  - [当前区域配置](#当前区域配置)
  - [管理区域](#管理区域)
- [物流配送](#物流配送)
  - [当前配送配置](#当前配送配置)
  - [配送选项说明](#配送选项说明)
- [支付配置](#支付配置)
- [销售渠道](#销售渠道)
- [API 密钥管理](#api-密钥管理)
- [常见运营场景](#常见运营场景)
- [注意事项](#注意事项)

---

## 登录管理面板

**访问地址：**

```
https://api.aidenlux.com/app/
```

使用管理员账号登录。首次登录需要由超级管理员创建账号。

> 如果页面空白或无法加载，检查浏览器是否禁用了第三方 Cookie，或尝试清除缓存后刷新。

---

## 面板总览

登录后进入控制台首页，左侧导航栏包含以下模块：

| 模块 | 说明 |
|------|------|
| Orders（订单） | 查看和管理所有订单 |
| Products（商品） | 管理商品、变体、定价、库存 |
| Collections（合集） | 管理商品合集（如 MCP 系列、CDU 系列） |
| Categories（分类） | 管理商品分类树 |
| Customers（客户） | 查看客户信息和订单历史 |
| Regions（区域） | 管理销售区域、货币、税率 |
| Settings（设置） | 系统设置、API 密钥、销售渠道、配送、支付等 |

---

## 商品管理

### 查看商品列表

1. 在左侧导航点击 **Products**
2. 列表显示所有商品，包括名称、状态（Draft/Published）、库存
3. 可使用搜索栏按名称/SKU 搜索
4. 可按状态、合集等条件筛选

### 创建新商品

1. 点击右上角 **Create Product** 按钮
2. 填写基本信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| Title | 商品名称 | CS-737X Throttle Quadrant |
| Subtitle | 副标题（可选） | Professional Flight Sim Throttle |
| Handle | URL 路径标识（自动生成，可修改） | cs-737x-tq |
| Description | 商品描述（支持富文本） | ... |
| Material | 材质（可选） | Aluminum Alloy |

3. 点击 **Save as Draft** 保存草稿，或 **Publish** 直接发布

> **Handle 很重要**：它是商品的唯一 URL 标识，也用于物流运费计算。一旦创建且有订单后，尽量不要修改。

### 编辑商品信息

1. 在商品列表点击目标商品
2. 进入详情页后，点击对应区域的 **Edit** 按钮
3. 修改完成后点击 **Save**

可编辑的区域包括：
- **General** — 标题、副标题、Handle、描述
- **Media** — 商品图片
- **Organize** — 合集、分类、标签、类型
- **Variants** — 变体（如不同配色、型号）
- **Metadata** — 自定义键值对

### 管理商品变体与定价

商品可以有多个变体（如不同颜色、尺码），每个变体有独立的 SKU、价格和库存。

**添加变体：**

1. 在商品详情页找到 **Variants** 区域
2. 点击 **Add Variant**
3. 填写变体信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| Title | 变体名称 | Black / Standard Edition |
| SKU | 库存单位编号 | CS-737X-TQ-BLK |
| Barcode | 条码（可选） | |
| Manage Inventory | 是否管理库存 | 启用 |

**设置价格：**

1. 点击变体，进入变体详情
2. 在 **Prices** 区域点击 **Edit Prices**
3. 为不同货币设置价格：

| 货币 | 说明 |
|------|------|
| USD | 美洲区域（美国、加拿大、墨西哥、南美等） |
| EUR | 国际区域（欧洲、中东、非洲、亚太等） |

4. 输入价格（**单位是分/cent**，例如 $29.99 填写 `2999`）
5. 点击 **Save**

> **定价单位提示**：Medusa 所有价格都以**最小货币单位**（分/cent）存储。$10.00 = 1000，EUR 15.50 = 1550。

### 上传商品图片

1. 在商品详情页找到 **Media** 区域
2. 点击 **Edit**
3. 拖拽或点击上传区域选择图片文件
4. 支持 JPG、PNG、WebP 格式
5. 第一张图片默认为缩略图（thumbnail），可拖拽调整顺序
6. 点击 **Save**

图片会自动上传到 Cloudflare R2 存储（CDN 地址：`img.aidenlux.com`），官网会自动使用 CDN 链接展示。

### 管理库存

1. 在商品变体详情中，确保 **Manage Inventory** 已启用
2. 进入 **Settings → Inventory** 或在变体详情中查看库存
3. 设置各仓库的可用数量

当前仓库配置：

| 仓库 | 说明 |
|------|------|
| European Warehouse | 默认仓库（哥本哈根） |

如需添加新仓库，在 **Settings → Stock Locations** 中操作。

---

## 商品合集管理

合集（Collection）用于将商品分组展示。官网的导航菜单和产品页面的分类筛选都基于合集。

### 创建合集

1. 在左侧导航点击 **Collections**
2. 点击 **Create Collection**
3. 填写信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| Title | 合集名称 | 737 Series |
| Handle | URL 路径标识 | 737-series |

4. 点击 **Save**

### 合集排序

合集在官网的显示顺序由 metadata 中的 `sort` 字段控制：

1. 在合集列表中点击目标合集
2. 找到 **Metadata** 区域，点击 **Edit**
3. 添加键值对：`sort` = `1`（数字越小越靠前）
4. 没有设置 `sort` 的合集会排在最后

### 将商品添加到合集

1. 进入目标合集的详情页
2. 找到 **Products** 区域，点击 **Add Products**
3. 在弹窗中搜索并勾选要加入的商品
4. 点击 **Save**

或者反向操作：

1. 进入商品详情页
2. 找到 **Organize** 区域，点击 **Edit**
3. 在 **Collection** 下拉框中选择合集
4. 点击 **Save**

---

## 商品分类管理

分类（Category）是独立于合集的另一种组织方式，支持多级嵌套。

1. 在左侧导航点击 **Categories**
2. 可看到树形分类结构
3. 点击 **Create Category** 新建
4. 分类支持父子关系（嵌套）

当前商品分类示例：Shirts、Sweatshirts、Pants、Merch 等。

> **合集 vs 分类的区别**：
> - **合集**：营销导向，用于专题、系列、促销活动分组，一个商品可以属于多个合集
> - **分类**：层级结构，用于商品的学术分类（如 CDU → A320 CDU），一个商品只能属于一个分类

---

## 订单管理

### 查看订单列表

1. 在左侧导航点击 **Orders**
2. 列表显示所有订单，默认按时间倒序
3. 可按状态筛选：
   - **Pending** — 待处理
   - **Completed** — 已完成
   - **Canceled** — 已取消
   - **Archived** — 已归档
4. 可按日期范围、付款状态、发货状态进一步筛选

### 查看订单详情

点击订单进入详情页，包含以下信息：

| 区域 | 内容 |
|------|------|
| Summary | 订单商品列表、数量、单价、小计 |
| Payment | 付款方式、付款状态、金额 |
| Fulfillment | 发货状态、物流信息 |
| Customer | 客户姓名、邮箱、联系方式 |
| Shipping Address | 收货地址 |
| Billing Address | 账单地址 |
| Timeline | 订单操作时间线（创建、付款、发货等） |

### 处理发货

当订单已付款后，需要手动创建发货记录：

1. 在订单详情页找到 **Fulfillment** 区域
2. 点击 **Create Fulfillment**
3. 选择要发货的商品和数量（默认全部）
4. 选择物流提供商（Dynamic Shipping 或 Manual）
5. 输入物流单号（Tracking Number）
6. 点击 **Complete**

发货后系统会自动：
- 发送发货通知邮件给客户（包含物流单号）
- 更新订单状态
- 扣减库存

> **部分发货**：如果部分商品缺货，可以只选择有库存的商品先发货，其余后续再创建新的发货记录。

### 处理退款

1. 在订单详情页找到 **Payment** 区域
2. 点击 **Refund**
3. 选择退款类型：
   - **Full Refund** — 全额退款
   - **Partial Refund** — 部分退款（手动输入金额）
4. 填写退款原因（内部备注）
5. 点击 **Complete**

退款会通过原支付渠道（PayPal）退回给客户。

> **退款注意**：PayPal 退款可能需要 3-5 个工作日到账。退款操作不可撤销，请谨慎操作。

---

## 客户管理

### 查看客户列表

1. 在左侧导航点击 **Customers**
2. 列表显示所有注册客户
3. 可搜索姓名或邮箱
4. 可筛选客户分组

### 查看客户详情

点击客户进入详情页：

| 区域 | 内容 |
|------|------|
| General | 姓名、邮箱、手机号 |
| Orders | 该客户的所有订单历史 |
| Addresses | 收货地址列表 |
| Groups | 所属客户分组 |
| Metadata | 自定义数据 |

### 客户分组

客户分组用于区分不同类型的客户（如 VIP、经销商等）：

1. 进入 **Customers** 页面
2. 点击 **Groups** 标签
3. 点击 **Create Group** 新建分组
4. 填写分组名称
5. 添加客户到分组

分组可用于：
- 限制特定商品/折扣的可见性
- 区分 B2B / B2C 客户
- 与 Discourse 论坛角色同步

---

## 区域与货币

### 当前区域配置

系统配置了两个销售区域：

| 区域名称 | 货币 | 覆盖范围 |
|----------|------|----------|
| Americas | USD ($) | 美国、加拿大、墨西哥、中南美洲 |
| International | EUR (EUR) | 欧洲、英国、中东、非洲、亚太、中国 |

### 管理区域

1. 进入 **Settings → Regions**
2. 点击区域名称查看或编辑

区域配置包括：

| 设置 | 说明 |
|------|------|
| Name | 区域名称 |
| Currency | 区域货币 |
| Countries | 该区域包含的国家 |
| Payment Providers | 可用支付方式 |
| Fulfillment Providers | 可用物流方式 |
| Tax Rate | 税率设置 |

**添加国家到区域：**

1. 在区域详情页找到 **Countries** 区域
2. 点击 **Add Countries**
3. 搜索并选择国家
4. 点击 **Save**

> **重要**：每个国家只能属于一个区域。如果要把国家从一个区域移到另一个，需要先从原区域删除。

---

## 物流配送

### 当前配送配置

系统配置了两种物流提供商：

| 提供商 | 类型 | 说明 |
|--------|------|------|
| Manual Fulfillment | 手动 | 标准手动发货流程 |
| Dynamic Shipping | 自动计算 | 根据商品和收货地区自动计算运费 |

### 配送选项说明

**Dynamic Shipping（动态运费）工作方式：**

运费按商品维度计算，每个商品可以有不同地区的运费费率。当前配置：

| 商品 Handle | 美洲 (USD) | 国际 (EUR) |
|-------------|-----------|------------|
| cs-737x-tq | $1.00 | $2.00 |
| 其他商品 | 免运费 | 免运费 |

运费特点：
- 按件计费，多件商品运费累加（如购买 2 件 cs-737x-tq 到美国 = $2.00）
- 未配置运费的商品自动免运费
- 运费不含税

> **添加新商品的运费**需要修改代码（`apps/medusa/src/modules/dynamic-shipping/service.ts` 中的 `PRODUCT_SHIPPING_RATES`），请联系开发人员。

**在管理面板中管理配送选项：**

1. 进入 **Settings → Shipping**
2. 选择区域（Americas / International）
3. 查看该区域下的配送选项
4. 可编辑配送选项名称和描述

---

## 支付配置

当前启用的支付方式：

| 支付方式 | 状态 | 说明 |
|----------|------|------|
| PayPal | 正式环境 | 支持信用卡和 PayPal 余额支付 |

**查看支付设置：**

1. 进入 **Settings → Payment**
2. 选择区域查看可用支付方式
3. PayPal 的 API 密钥通过环境变量配置，无需在面板中修改

> 如需添加其他支付方式（如 Stripe），请联系开发人员。

---

## 销售渠道

销售渠道决定哪些商品在哪些前端展示。

1. 进入 **Settings → Sales Channels**
2. 当前有一个默认渠道：**Webshop**

**将商品添加到销售渠道：**

1. 进入销售渠道详情
2. 点击 **Add Products**
3. 搜索并勾选商品
4. 点击 **Save**

> **注意**：新创建的商品默认不会出现在任何销售渠道中。需要手动将商品添加到 Webshop 渠道，它才会在官网上显示。

---

## API 密钥管理

API 密钥用于前端应用（官网）访问 Medusa 后端。

1. 进入 **Settings → API Key Management** (或 **Publishable API Keys**)
2. 当前有一个密钥：**Webshop**
3. 该密钥关联到 Webshop 销售渠道

> **不要删除或重新生成**正在使用的 API 密钥，否则官网会立即无法访问商品和购物车数据。如需轮换密钥，请先通知开发人员更新环境变量。

---

## 常见运营场景

### 场景 1：上架一款新商品

```
1. Products → Create Product → 填写标题、描述、Handle
2. 上传商品图片（Media 区域）
3. 添加变体（如有不同版本/配色）
4. 为每个变体设置 USD 和 EUR 价格
5. 设置库存数量
6. 将商品添加到合集（Organize → Collection）
7. 将商品添加到 Webshop 销售渠道
8. 将状态从 Draft 改为 Published
```

### 场景 2：商品调价

```
1. Products → 找到目标商品
2. 点击变体 → Edit Prices
3. 修改 USD 和/或 EUR 价格（记得输入分/cent）
4. Save
```

官网价格会实时更新（无缓存延迟）。

### 场景 3：处理新订单

```
1. Orders → 点击新订单
2. 确认付款状态为 Captured（已付款）
3. 准备商品打包
4. Create Fulfillment → 输入物流单号 → Complete
5. 客户会自动收到发货通知邮件
```

### 场景 4：商品暂时下架

```
1. Products → 找到目标商品
2. 点击右上角状态标签
3. 改为 Draft（草稿状态）
```

Draft 状态的商品不会在官网显示，但已存在的购物车中如果包含该商品，用户仍能看到。

### 场景 5：查看某个客户的所有订单

```
1. Customers → 搜索客户邮箱
2. 点击客户 → 查看 Orders 区域
```

### 场景 6：创建促销合集

```
1. Collections → Create Collection
2. 填写标题 "Summer Sale" 和 Handle "summer-sale"
3. 添加参加促销的商品
4. 设置 Metadata: sort = 1（让它显示在第一位）
```

---

## 注意事项

### 价格单位

Medusa 的所有价格以**最小货币单位**存储：

| 显示价格 | 管理面板中填写 |
|----------|---------------|
| $10.00 | 1000 |
| $29.99 | 2999 |
| EUR 149.00 | 14900 |
| $0.50 | 50 |

### 商品 Handle

- Handle 是商品在 URL 中的标识：`https://prd.aidenlux.com/us/products/{handle}`
- 创建时自动从标题生成，但可以手动修改
- **建议使用小写字母和短横线**，如 `cs-737x-tq`
- Handle 也用于运费计算系统匹配商品
- 修改 Handle 会导致旧链接失效

### 商品状态

| 状态 | 说明 |
|------|------|
| Draft | 草稿，仅管理面板可见 |
| Published | 已发布，官网可见 |

### 订单状态

| 状态 | 说明 |
|------|------|
| Pending | 新订单，待处理 |
| Completed | 已完成（已发货且已付款） |
| Canceled | 已取消 |
| Requires Action | 需要人工处理（如支付异常） |

### 邮件通知

系统在以下事件时自动发送邮件：

| 事件 | 邮件内容 | 收件人 |
|------|----------|--------|
| 客户注册 | 欢迎邮件 | 新客户 |
| 下单成功 | 订单确认（含商品清单、金额、地址） | 客户 |
| 已发货 | 发货通知（含物流单号） | 客户 |
| 密码重置 | 重置链接 | 客户 |

邮件由 Resend 服务发送，发件人为 `noreply@aidenlux.com`。

### 图片上传

- 支持格式：JPG、PNG、WebP
- 建议尺寸：至少 800x800 像素
- 图片自动上传到 CDN（`img.aidenlux.com`），全球加速
- 第一张图为商品缩略图

### 数据安全

- 管理面板登录信息不要与他人共享
- 退款操作不可撤销
- 删除商品前确认没有未完成的订单关联
- 不要删除正在使用的 API 密钥或销售渠道
